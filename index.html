<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Aromatic POS - Punto de Venta Premium</title>
    <meta name="description"
        content="Sistema de punto de venta premium para cafeterÃ­as. GestiÃ³n de inventarios, insumos y reportes.">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap"
        rel="stylesheet">

    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/keyboard.css">

    <!-- Shepherd.js Onboarding Tour -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/shepherd.js@10.0.1/dist/css/shepherd.css" />
    <script src="https://cdn.jsdelivr.net/npm/shepherd.js@10.0.1/dist/js/shepherd.min.js"></script>

    <link rel="manifest" href="manifest.json">
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker registration failed', err));
            });
        }
    </script>
</head>

<body class="bg-coffee-light">
    <div id="app" class="app-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar" id="mainSidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <img src="recursos/logo efimero.png" alt="Aromatic Logo" class="logo-icon">
                    <span>Aromatic</span>
                </div>
                <button class="sidebar-toggle" id="sidebarToggle">
                    <i data-lucide="menu"></i>
                </button>
            </div>
            <ul class="nav-links">
                <li class="active" data-view="pos">
                    <i data-lucide="layout-grid"></i>
                    <span>POS</span>
                </li>
                <li data-view="tables">
                    <i data-lucide="utensils"></i>
                    <span>Mesas</span>
                </li>
                <li data-view="inventory">
                    <i data-lucide="package"></i>
                    <span>Inventario</span>
                </li>
                <li data-view="customers">
                    <i data-lucide="users"></i>
                    <span>Clientes</span>
                </li>
                <li data-view="sales">
                    <i data-lucide="bar-chart-3"></i>
                    <span>Ventas</span>
                </li>
                <li data-view="cash-closing">
                    <i data-lucide="calculator"></i>
                    <span>Corte de Caja</span>
                </li>
                <li data-view="settings">
                    <i data-lucide="settings"></i>
                    <span>ConfiguraciÃ³n</span>
                </li>
            </ul>
            <div class="sidebar-footer">
                <div class="user-profile" id="userProfileBtn" style="cursor: pointer;" title="Cambiar de Usuario">
                    <div class="avatar" id="currentUserAvatar">AD</div>
                    <div class="user-info">
                        <span class="user-name" id="currentUserName">Administrador</span>
                        <span class="user-role" id="currentUserRole">Cajero Principal</span>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <header class="top-bar">
                <div class="search-container">
                    <i data-lucide="search"></i>
                    <input type="text" id="globalSearch" placeholder="Buscar productos, ventas o insumos...">
                </div>
                <div class="top-bar-actions">
                    <div class="status-badge online">
                        <span class="pulse"></span>
                        En LÃ­nea
                    </div>
                    <button class="btn-icon" id="toggleKeyboardBtn" onclick="virtualKeyboard.toggle()"
                        title="Teclado Virtual" style="background: rgba(226, 150, 93, 0.1); color: var(--accent);">
                        <i data-lucide="keyboard"></i>
                    </button>
                    <button class="btn-icon" id="notificationsBtn">
                        <i data-lucide="bell"></i>
                    </button>
                    <div class="current-time" id="clock">12:00:00</div>
                </div>
            </header>

            <section id="view-container" class="view-container">
                <!-- Views will be injected here -->
            </section>
        </main>

        <!-- Right Side Panel (Cart for POS) -->
        <aside class="right-panel" id="posCartPanel">
            <div class="panel-tabs"
                style="display: flex; background: #f0f0f0; padding: 5px; border-bottom: 1px solid #ddd;">
                <button class="panel-tab-btn active" id="tabCart"
                    style="flex: 1; padding: 10px; border: none; background: none; cursor: pointer; font-weight: 600; border-radius: 8px;">ðŸ›’
                    Orden</button>
                <button class="panel-tab-btn" id="tabHistory"
                    style="flex: 1; padding: 10px; border: none; background: none; cursor: pointer; font-weight: 600; border-radius: 8px;">ðŸ•’
                    Hoy</button>
            </div>

            <!-- Cart Section -->
            <div id="cartSection" style="display: flex; flex-direction: column; flex: 1; overflow: hidden;">
                <div class="ticket-tabs-container">
                    <div id="ticketTabs" class="ticket-tabs">
                        <!-- Ticket tabs injected here -->
                    </div>
                    <button class="btn-add-ticket" id="addNewTicketBtn">
                        <i data-lucide="plus"></i>
                    </button>
                </div>
                <div class="panel-header" style="padding: 12px 20px; display: flex; flex-direction: column; gap: 8px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                        <h3 id="currentTicketTitle" style="font-size: 1.2rem; margin: 0;">Orden #1</h3>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn-clear" id="clearCart">Limpiar</button>
                        </div>
                    </div>

                    <!-- Compact Customer Selection -->
                    <div id="customerSelectionArea" style="width: 100%;">
                        <div id="selectedCustomerDisplay"
                            style="display: none; align-items: center; justify-content: space-between; background: rgba(75, 54, 33, 0.05); padding: 6px 12px; border-radius: 10px; border: 1px solid rgba(75, 54, 33, 0.1);">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <i data-lucide="user" style="width: 14px; height: 14px; color: var(--primary);"></i>
                                <div>
                                    <span id="customerNameInCart"
                                        style="display: block; font-weight: 600; font-size: 0.85rem; line-height: 1;">Cliente</span>
                                    <span id="customerPointsInCart"
                                        style="display: block; font-size: 0.7rem; color: var(--accent); margin-top: 2px;">0
                                        pts</span>
                                </div>
                            </div>
                            <button class="btn-icon-small" id="removeCustomerBtn"
                                style="width: 20px; height: 20px; padding: 0;" title="Quitar cliente">
                                <i data-lucide="x" style="width: 12px; height: 12px;"></i>
                            </button>
                        </div>
                        <button class="btn-secondary" id="selectCustomerBtn"
                            style="width: 100%; padding: 6px; font-size: 0.75rem; border-style: dashed; border-radius: 8px; display: flex; align-items: center; justify-content: center; gap: 6px;">
                            <i data-lucide="user-plus" style="width: 12px;"></i> Asignar Cliente
                        </button>
                    </div>
                </div>
                <div class="cart-items" id="cartItems">
                    <!-- Cart items injected here -->
                </div>
                <div class="panel-footer">
                    <div class="summary">
                        <div class="summary-row">
                            <span>Subtotal</span>
                            <span id="cartSubtotal">$0.00</span>
                        </div>
                        <div class="summary-row" id="taxRow">
                            <span>IVA</span>
                            <span id="cartTax">$0.00</span>
                        </div>
                        <div class="summary-row" id="promoRow"
                            style="display: none; color: var(--accent); font-weight: 600;">
                            <span>Promociones</span>
                            <span id="cartPromo">-$0.00</span>
                        </div>
                        <div class="summary-row total">
                            <span>Total</span>
                            <span id="cartTotal">$0.00</span>
                        </div>
                    </div>
                    <button class="btn-checkout" id="checkoutBtn">
                        <span style="display: flex; align-items: center; gap: 8px;">
                            COBRAR <small
                                style="background: rgba(255,255,255,0.2); padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; font-weight: 800; border: 1px solid rgba(255,255,255,0.3);">F12</small>
                        </span>
                        <i data-lucide="banknote"></i>
                    </button>
                </div>
            </div>

            <!-- History Section (Hidden by default) -->
            <div id="historySection" class="hidden"
                style="flex: 1; overflow-y: auto; display: flex; flex-direction: column;">
                <div style="padding: 24px 24px 15px; flex-shrink: 0;">
                    <h3
                        style="margin-bottom: 20px; font-family: 'Playfair Display', serif; font-size: 1.6rem; color: var(--primary); display: flex; align-items: center; gap: 10px;">
                        <i data-lucide="history" style="width: 24px; color: var(--accent);"></i>
                        Ventas de Hoy
                    </h3>

                    <div class="search-container"
                        style="display: flex; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 12px; padding: 10px 15px; align-items: center; gap: 10px; margin-bottom: 5px;">
                        <i data-lucide="search" style="width: 16px; color: #94a3b8;"></i>
                        <input type="text" id="historySearch" placeholder="Buscar por folio o producto..."
                            style="background: transparent; border: none; outline: none; width: 100%; font-size: 0.9rem; font-family: 'Outfit', sans-serif;">
                    </div>
                </div>

                <div id="dailySalesList" class="hide-scrollbar"
                    style="flex: 1; overflow-y: auto; padding: 0 24px 24px;">
                    <!-- Daily sales cards injected here -->
                </div>
            </div>
        </aside>
    </div>

    <!-- Modals -->
    <div id="modalContainer" class="modal-overlay hidden">
        <div class="modal-content">
            <!-- Modal content injected here -->
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    <script src="js/firebase-config.js"></script>
    <script src="js/db.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/sounds.js"></script>
    <script src="js/keyboard.js"></script>
    <script src="js/views/pos.js"></script>
    <script src="js/views/inventory.js"></script>
    <script src="js/views/waste.js"></script>
    <script src="js/views/customers.js"></script>
    <script src="js/views/supplies.js"></script>
    <script src="js/views/sales.js"></script>
    <script src="js/views/cashClosing.js"></script>
    <script src="js/views/settings.js"></script>
    <script src="js/views/ticket.js"></script>
    <script src="js/views/tables.js"></script>
    <script src="js/views/users.js"></script>
    <script src="js/app.js"></script>
    <script>
        // Initialize Lucide icons
        lucide.createIcons();
    </script>
</body>

</html>